version: 1
title: Spec Runner Contract Traceability
links:
  - rule_id: CLI_RUN_ENTRYPOINT_REQUIRED
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_ENTRYPOINT_REQUIRED
    contract_refs:
      - docs/spec/contract/04_harness.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-CLI-001
    unit_test_refs:
      - tests/test_harness_cli_run_unit.py
      - tests/test_conformance_runner_unit.py
    implementation_refs:
      - spec_runner/harnesses/cli_run.py
    notes: "Explicit entrypoint is recommended for project specs and enforced for portable conformance fixtures."

  - rule_id: CLI_RUN_ENTRYPOINT_ENV_FALLBACK
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_ENTRYPOINT_ENV_FALLBACK
    contract_refs:
      - docs/spec/contract/04_harness.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs: []
    implementation_refs:
      - spec_runner/harnesses/cli_run.py
    notes: "Implementation SHOULD; not required for conformance."

  - rule_id: CLI_RUN_SAFE_MODE_RESTRICTS_HOOKS_AND_FALLBACK
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_SAFE_MODE_RESTRICTS_HOOKS_AND_FALLBACK
    contract_refs:
      - docs/spec/contract/04_harness.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_harness_cli_run_unit.py
    implementation_refs:
      - spec_runner/harnesses/cli_run.py
    notes: "Python safe mode disables hooks and env fallback when enabled."

  - rule_id: CLI_RUN_ENV_ALLOWLIST_CONTROL
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_ENV_ALLOWLIST_CONTROL
    contract_refs:
      - docs/spec/contract/04_harness.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_php_spec_runner_unit.py
    implementation_refs:
      - scripts/php/spec_runner.php
    notes: "PHP runner supports allowlisting ambient env for cli.run subprocesses."

  - rule_id: CLI_RUN_CONFORMANCE_EXPLICIT_ENTRYPOINT
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_CONFORMANCE_EXPLICIT_ENTRYPOINT
    contract_refs:
      - docs/spec/contract/04_harness.md
      - docs/spec/contract/06_conformance.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-CLI-001
      - SRCONF-CLI-002
    unit_test_refs:
      - tests/test_contract_governance_unit.py
      - tests/test_conformance_runner_unit.py
    implementation_refs: []
    notes: "Conformance seed fixtures include explicit harness.entrypoint values."

  - rule_id: CLI_RUN_CONFORMANCE_NO_ENV_DEPENDENCY
    policy_ref: docs/spec/contract/policy_v1.yaml#CLI_RUN_CONFORMANCE_NO_ENV_DEPENDENCY
    contract_refs:
      - docs/spec/contract/04_harness.md
      - docs/spec/contract/06_conformance.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-CLI-001
      - SRCONF-CLI-002
    unit_test_refs:
      - tests/test_contract_governance_unit.py
      - tests/test_conformance_runner_unit.py
    implementation_refs: []
    notes: "Conformance fixtures are explicit and do not require env fallback."

  - rule_id: ASSERT_HEALTH_MODE_VALID_VALUES
    policy_ref: docs/spec/contract/policy_v1.yaml#ASSERT_HEALTH_MODE_VALID_VALUES
    contract_refs:
      - docs/spec/contract/02_case_shape.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-AH-003
    unit_test_refs:
      - tests/test_assertion_health_unit.py
    implementation_refs:
      - spec_runner/assertion_health.py
    notes: "Value validation and mode parsing are enforced in assertion_health."

  - rule_id: ASSERT_HEALTH_GLOBAL_AND_PER_CASE_POLICY
    policy_ref: docs/spec/contract/policy_v1.yaml#ASSERT_HEALTH_GLOBAL_AND_PER_CASE_POLICY
    contract_refs:
      - docs/spec/contract/00_design_goals.md
      - docs/spec/contract/02_case_shape.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-AH-001
      - SRCONF-AH-002
      - SRCONF-AH-004
    unit_test_refs:
      - tests/test_assertion_health_unit.py
      - tests/test_harness_cli_run_unit.py
      - tests/test_harness_text_file_unit.py
    implementation_refs:
      - spec_runner/assertion_health.py
      - spec_runner/harnesses/cli_run.py
      - spec_runner/harnesses/text_file.py
    notes: "Global env policy plus per-case override implemented for Python harnesses."

  - rule_id: ASSERT_HEALTH_REDUNDANT_BRANCH_DIAGNOSTIC
    policy_ref: docs/spec/contract/policy_v1.yaml#ASSERT_HEALTH_REDUNDANT_BRANCH_DIAGNOSTIC
    contract_refs:
      - docs/spec/contract/00_design_goals.md
      - docs/spec/contract/03_assertions.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-AH-005
    unit_test_refs:
      - tests/test_assertion_health_unit.py
      - tests/test_harness_cli_run_unit.py
    implementation_refs:
      - spec_runner/assertion_health.py
      - spec_runner/harnesses/cli_run.py
    notes: "Python emits AH004 for redundant sibling branches."

  - rule_id: ASSERT_HEALTH_NON_PORTABLE_REGEX_DIAGNOSTIC
    policy_ref: docs/spec/contract/policy_v1.yaml#ASSERT_HEALTH_NON_PORTABLE_REGEX_DIAGNOSTIC
    contract_refs:
      - docs/spec/contract/00_design_goals.md
      - docs/spec/contract/03_assertions.md
      - docs/spec/contract/03a_regex_portability_v1.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-AH-006
    unit_test_refs:
      - tests/test_assertion_health_unit.py
      - tests/test_conformance_runner_unit.py
    implementation_refs:
      - spec_runner/assertion_health.py
      - spec_runner/harnesses/text_file.py
      - spec_runner/harnesses/cli_run.py
    notes: "Python emits AH005 for non-portable regex constructs."

  - rule_id: SPEC_LANG_EVALUATE_LIST_SHAPE
    policy_ref: docs/spec/contract/policy_v1.yaml#SPEC_LANG_EVALUATE_LIST_SHAPE
    contract_refs:
      - docs/spec/contract/03_assertions.md
      - docs/spec/contract/03b_spec_lang_v1.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-EXPR-001
      - SRCONF-EXPR-005
      - SRCONF-EXPR-006
    unit_test_refs:
      - tests/test_assertions_unit.py
      - tests/test_spec_lang_unit.py
    implementation_refs:
      - spec_runner/assertions.py
      - spec_runner/spec_lang.py
      - scripts/php/spec_runner.php
      - scripts/php/conformance_runner.php
    notes: "Evaluate leaves accept list-encoded S-expressions and reject malformed forms."

  - rule_id: SPEC_LANG_PURE_EVALUATOR
    policy_ref: docs/spec/contract/policy_v1.yaml#SPEC_LANG_PURE_EVALUATOR
    contract_refs:
      - docs/spec/contract/03b_spec_lang_v1.md
      - docs/spec/contract/06_conformance.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-EXPR-001
      - SRCONF-EXPR-002
    unit_test_refs:
      - tests/test_spec_lang_unit.py
    implementation_refs:
      - spec_runner/spec_lang.py
      - scripts/php/spec_runner.php
      - scripts/php/conformance_runner.php
    notes: "Evaluator core is deterministic and pure for supported forms."

  - rule_id: SPEC_LANG_PROPER_TCO_REQUIRED
    policy_ref: docs/spec/contract/policy_v1.yaml#SPEC_LANG_PROPER_TCO_REQUIRED
    contract_refs:
      - docs/spec/contract/03b_spec_lang_v1.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-EXPR-003
    unit_test_refs:
      - tests/test_spec_lang_unit.py
    implementation_refs:
      - spec_runner/spec_lang.py
      - scripts/php/spec_runner.php
      - scripts/php/conformance_runner.php
    notes: "Tail-position call is implemented via iterative trampoline loops."

  - rule_id: SPEC_LANG_EVAL_BUDGETS_REQUIRED
    policy_ref: docs/spec/contract/policy_v1.yaml#SPEC_LANG_EVAL_BUDGETS_REQUIRED
    contract_refs:
      - docs/spec/contract/03b_spec_lang_v1.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-EXPR-007
    unit_test_refs:
      - tests/test_spec_lang_unit.py
      - tests/test_harness_cli_run_unit.py
    implementation_refs:
      - spec_runner/spec_lang.py
      - scripts/php/spec_runner.php
      - scripts/php/conformance_runner.php
    notes: "Steps/nodes/literal/timeout budgets are enforced with deterministic failure reasons."

  - rule_id: SPEC_LANG_ERROR_CLASSIFICATION
    policy_ref: docs/spec/contract/policy_v1.yaml#SPEC_LANG_ERROR_CLASSIFICATION
    contract_refs:
      - docs/spec/contract/03b_spec_lang_v1.md
      - docs/spec/contract/05_errors.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-EXPR-004
      - SRCONF-EXPR-005
      - SRCONF-EXPR-006
      - SRCONF-EXPR-007
    unit_test_refs:
      - tests/test_spec_lang_unit.py
      - tests/test_conformance_parity_unit.py
    implementation_refs:
      - spec_runner/spec_lang.py
      - spec_runner/conformance.py
      - scripts/php/conformance_runner.php
    notes: "Conformance maps evaluate failures to schema/assertion/runtime categories."

  - rule_id: DOC_NORMATIVE_PAGE_TRACEABILITY
    policy_ref: docs/spec/contract/policy_v1.yaml#DOC_NORMATIVE_PAGE_TRACEABILITY
    contract_refs:
      - docs/spec/contract/00_design_goals.md
      - docs/spec/contract/versioning.md
      - docs/spec/contract/01_discovery.md
      - docs/spec/contract/02_case_shape.md
      - docs/spec/contract/03_assertions.md
      - docs/spec/contract/03a_regex_portability_v1.md
      - docs/spec/contract/04_harness.md
      - docs/spec/contract/05_errors.md
      - docs/spec/contract/06_conformance.md
      - docs/spec/contract/07_portable_spec_authoring.md
      - docs/spec/contract/08_v1_scope.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_contract_governance_unit.py
    implementation_refs:
      - spec_runner/contract_governance.py
    notes: "Governance enforces traceability coverage across normative contract pages."

  - rule_id: DOC_REGEX_PROFILE_LINKAGE
    policy_ref: docs/spec/contract/policy_v1.yaml#DOC_REGEX_PROFILE_LINKAGE
    contract_refs:
      - docs/spec/contract/03_assertions.md
      - docs/spec/contract/03a_regex_portability_v1.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_contract_governance_unit.py
    implementation_refs:
      - spec_runner/contract_governance.py
    notes: "Governance checks profile references across assertion, schema, and policy docs."

  - rule_id: DOC_ASSERTION_OPERATOR_DOC_SYNC
    policy_ref: docs/spec/contract/policy_v1.yaml#DOC_ASSERTION_OPERATOR_DOC_SYNC
    contract_refs:
      - docs/spec/contract/03_assertions.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_contract_governance_unit.py
    implementation_refs:
      - spec_runner/contract_governance.py
    notes: "Governance checks synchronized core operator tokens between docs."

  - rule_id: CONFORMANCE_EXPECT_OVERLAY_RESOLUTION
    policy_ref: docs/spec/contract/policy_v1.yaml#CONFORMANCE_EXPECT_OVERLAY_RESOLUTION
    contract_refs:
      - docs/spec/contract/06_conformance.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_conformance_runner_unit.py
      - tests/test_php_conformance_subset_unit.py
    implementation_refs:
      - spec_runner/conformance.py
    notes: "Conformance expectations resolve portable baseline with implementation overlays."

  - rule_id: CONFORMANCE_CASE_STYLE_GUARD
    policy_ref: docs/spec/contract/policy_v1.yaml#CONFORMANCE_CASE_STYLE_GUARD
    contract_refs:
      - docs/spec/contract/06_conformance.md
      - docs/spec/conformance/style.md
    schema_refs: []
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_contract_governance_unit.py
    implementation_refs:
      - spec_runner/contract_governance.py
    notes: "Governance enforces conformance case doc readability/style constraints."

  - rule_id: CONFORMANCE_REQUIRES_CAPABILITIES_POLICY
    policy_ref: docs/spec/contract/policy_v1.yaml#CONFORMANCE_REQUIRES_CAPABILITIES_POLICY
    contract_refs:
      - docs/spec/contract/06_conformance.md
      - docs/spec/conformance/report_format.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_conformance_runner_unit.py
      - tests/test_validate_conformance_report_unit.py
    implementation_refs:
      - spec_runner/conformance.py
    notes: "Conformance runner enforces requires.capabilities with skip/fail policy."

  - rule_id: PORTABLE_SPEC_CANONICAL_SINGLE_SET
    policy_ref: docs/spec/contract/policy_v1.yaml#PORTABLE_SPEC_CANONICAL_SINGLE_SET
    contract_refs:
      - docs/spec/contract/06_conformance.md
      - docs/spec/contract/07_portable_spec_authoring.md
      - docs/spec/conformance/README.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_contract_governance_unit.py
      - tests/test_conformance_runner_unit.py
    implementation_refs:
      - spec_runner/contract_governance.py
      - spec_runner/conformance.py
    notes: "Portable behavior source is the canonical conformance case set."

  - rule_id: PORTABLE_SPEC_EXPECT_PORTABLE_IMPL_OVERLAY
    policy_ref: docs/spec/contract/policy_v1.yaml#PORTABLE_SPEC_EXPECT_PORTABLE_IMPL_OVERLAY
    contract_refs:
      - docs/spec/contract/06_conformance.md
      - docs/spec/contract/07_portable_spec_authoring.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids: []
    unit_test_refs:
      - tests/test_conformance_runner_unit.py
      - tests/test_php_conformance_subset_unit.py
    implementation_refs:
      - spec_runner/conformance.py
    notes: "Expectations resolve from portable baseline with optional runtime overlays."

  - rule_id: PORTABLE_SPEC_DETERMINISM_BY_CONSTRUCTION
    policy_ref: docs/spec/contract/policy_v1.yaml#PORTABLE_SPEC_DETERMINISM_BY_CONSTRUCTION
    contract_refs:
      - docs/spec/contract/06_conformance.md
      - docs/spec/contract/07_portable_spec_authoring.md
    schema_refs:
      - docs/spec/schema/schema_v1.md
    conformance_case_ids:
      - SRCONF-CLI-001
      - SRCONF-AH-004
    unit_test_refs:
      - tests/test_conformance_runner_unit.py
    implementation_refs:
      - spec_runner/conformance.py
    notes: "Portable cases should avoid ambient dependencies and express variability explicitly."
