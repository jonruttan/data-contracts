version: 1
title: Spec Runner Portable Contract Policy
rules:
  - id: CLI_RUN_ENTRYPOINT_REQUIRED
    introduced_in: v1
    scope: case
    applies_to: cli.run.harness.entrypoint
    norm: MUST
    requirement: present
    description: For cli.run, harness.entrypoint must be set in each case.
    rationale: Ensures portable, explicit invocation without hidden runner state.
    risk_if_violated: Cases become environment-dependent and non-portable.
    references:
      - docs/spec/contract/04-harness.md
      - docs/spec/schema/schema-v1.md

  - id: CLI_RUN_ENTRYPOINT_ENV_FALLBACK
    introduced_in: v1
    scope: implementation
    applies_to: cli.run.entrypoint_resolution
    norm: SHOULD
    requirement: support_env_fallback_when_process_env_and_dynamic_entrypoint_loading_are_available
    description: >
      Implementations should support environment fallback for local/CI
      ergonomics when they can read process environment variables and resolve
      dynamic module:attribute entrypoints at runtime.
    rationale: Improves ergonomics in local and containerized workflows.
    risk_if_violated: Higher setup friction in some environments.
    examples:
      - SPEC_RUNNER_ENTRYPOINT
    references:
      - docs/spec/contract/04-harness.md
      - docs/spec/impl/python.md

  - id: CLI_RUN_CONFORMANCE_EXPLICIT_ENTRYPOINT
    introduced_in: v1
    scope: conformance
    applies_to: fixtures.cli.run
    norm: MUST
    requirement: explicit_harness_entrypoint
    description: Portable conformance fixtures must set harness.entrypoint.
    rationale: Keeps parity checks independent of implementation conveniences.
    risk_if_violated: Conformance results can diverge across runtimes.
    references:
      - docs/spec/contract/04-harness.md
      - docs/spec/contract/06-conformance.md

  - id: CLI_RUN_CONFORMANCE_NO_ENV_DEPENDENCY
    introduced_in: v1
    scope: conformance
    applies_to: fixtures.cli.run
    norm: MUST_NOT
    requirement: rely_on_env_fallback
    description: Portable conformance fixtures must not depend on env fallback.
    rationale: Prevents ambient-environment coupling in parity tests.
    risk_if_violated: Flaky or non-reproducible cross-language conformance.
    references:
      - docs/spec/contract/04-harness.md
      - docs/spec/contract/06-conformance.md

  - id: ASSERT_HEALTH_MODE_VALID_VALUES
    introduced_in: v1
    scope: case
    applies_to: assert_health.mode
    norm: MUST
    requirement: accept_only_ignore_warn_error
    description: >
      When assert_health.mode is provided, only ignore, warn, or error are
      valid values.
    rationale: Keeps diagnostics policy deterministic and portable.
    risk_if_violated: Implementations diverge on policy interpretation.
    references:
      - docs/spec/contract/02-case-shape.md
      - docs/spec/schema/schema-v1.md

  - id: ASSERT_HEALTH_GLOBAL_AND_PER_CASE_POLICY
    introduced_in: v1
    scope: implementation
    applies_to: assertion_health.policy_resolution
    norm: SHOULD
    requirement: support_global_default_and_per_case_override
    description: >
      Implementations should support both a global default policy and a
      per-case override for assertion-health diagnostics.
    rationale: Enables gradual rollout and targeted strictness.
    risk_if_violated: Hard to adopt diagnostics without broad breakage.
    references:
      - docs/spec/contract/00-design-goals.md
      - docs/spec/contract/02-case-shape.md

  - id: ASSERT_HEALTH_REDUNDANT_BRANCH_DIAGNOSTIC
    introduced_in: v1
    scope: case
    applies_to: assert.tree.group_children
    norm: SHOULD
    requirement: detect_redundant_sibling_branches
    description: >
      Implementations should diagnose redundant sibling assertion branches
      within a group (`must`, `can`, `cannot`) and surface them via
      assertion-health policy modes.
    rationale: Redundant branches hide intent and create maintenance noise.
    risk_if_violated: Specs can pass while carrying misleading duplicate logic.
    references:
      - docs/spec/contract/00-design-goals.md
      - docs/spec/contract/03-assertions.md
      - docs/spec/schema/schema-v1.md

  - id: ASSERT_HEALTH_NON_PORTABLE_REGEX_DIAGNOSTIC
    introduced_in: v1
    scope: case
    applies_to: assert.tree.regex
    norm: SHOULD
    requirement: detect_non_portable_regex_constructs
    description: >
      Implementations should diagnose regex patterns that use non-portable
      constructs and surface them via assertion-health policy modes.
    rationale: Preserves cross-language determinism and reduces portability drift.
    risk_if_violated: Specs may pass in one runtime and fail in another.
    references:
      - docs/spec/contract/00-design-goals.md
      - docs/spec/contract/03-assertions.md
      - docs/spec/schema/schema-v1.md
